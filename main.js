(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_visible"),document.addEventListener("keydown",r)}function n(e){e.classList.remove("popup_visible"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&n(document.querySelector(".popup_visible"))}e.d({},{xS:()=>D});var o=document.querySelector(".popup__form-profile"),c=document.querySelector("input[name='place-name']"),u=document.querySelector("input[name='place-image']"),a=document.querySelector("#title"),l=document.querySelector("#subtitle"),i=document.querySelector(".profile-popup"),s=document.querySelector(".place-popup"),d=document.querySelector(".profile__title"),f=document.querySelector(".profile__subtitle"),p=document.querySelector(".profile__avatar"),m=i.querySelector(".popup__button-save"),v=(i.querySelector(".popup__form-profile"),s.querySelector(".popup__button-save")),y=o.elements.title,_=o.elements.subtitle,h=document.querySelector(".popup__form-avatar"),b=document.querySelector(".avatar-popup"),S=b.querySelector(".popup__button-save"),q=b.querySelector(".popup__input"),C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_inactive",inputErrorClass:"popup__error",errorClass:"popup__error_type_active"};function g(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))}var L=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);g(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),g(n,r,t)}))}))},E={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"07334549-14cd-4eab-a623-6223aa527f74","Content-Type":"application/json"}};function k(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}var x=document.querySelector("#element-template").content,A=document.querySelector(".elements"),w=document.querySelector(".popup__image"),U=document.querySelector(".popup__caption"),O=document.querySelector(".image-popup"),j=document.querySelector(".popup__form-place");function P(e,n,r,o,c){var u=x.querySelector(".element").cloneNode(!0),a=u.querySelector(".element__title"),l=u.querySelector(".element__image"),i=u.querySelector(".element__button-heart"),s=u.querySelector(".element__button-delete"),d=u.querySelector(".element__theme");return a.textContent=r,l.src=n,l.alt=r,l.addEventListener("click",(function(e){w.src=e.target.src,w.alt=e.target.alt,U.textContent=e.target.alt,t(O)})),u.id=o,s.addEventListener("click",(function(e){var t=e.target.closest(".element");(function(e){return fetch("".concat(E.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:E.headers}).then((function(e){return k(e)}))})(t.id).then((function(){return t.remove()})).catch((function(e){return console.log(e)}))})),i.addEventListener("click",(function(e){var t=e.target.closest(".element");i.classList.contains("element__button-heart_active")?function(e){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:E.headers}).then((function(e){return k(e)}))}(t.id).then((function(e){t.querySelector(".element__button-heart-counter").textContent=e.likes.length,i.classList.remove("element__button-heart_active")})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:E.headers}).then((function(e){return k(e)}))}(t.id).then((function(e){d.querySelector(".element__button-heart-counter").textContent=e.likes.length,i.classList.add("element__button-heart_active")})).catch((function(e){return console.log(e)}))})),c!==D&&s.remove(),d.querySelector(".element__button-heart-counter").textContent=e.length,e.some((function(e){return e._id===D}))&&i.classList.add("element__button-heart_active"),u}function T(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){a=!0,c=e},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw c}}}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var D,N,I,J=document.querySelector(".profile__edit-button"),H=document.querySelector(".profile__add-button"),M=document.querySelector("button[name='close-profile-button']"),z=document.querySelector("button[name='close-place-button']"),$=document.querySelector("button[name='close-image-button']"),F=document.querySelectorAll(".popup"),G=document.querySelector(".profile__avatar-overlay"),K=b.querySelector(".popup__button-close"),Q=Array.from(s.querySelectorAll(C.inputSelector)),R=Array.from(b.querySelectorAll(C.inputSelector)),V=T(F);try{var W=function(){var e=N.value;e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_visible")&&n(e)}))};for(V.s();!(N=V.n()).done;)W()}catch(e){V.e(e)}finally{V.f()}function X(e){d.textContent=e.name,f.textContent=e.about,p.src=e.avatar}J.addEventListener("click",(function(){a.value=d.textContent,l.value=f.textContent,t(i)})),j.addEventListener("submit",(function(e){var t,r;e.preventDefault(),v.textContent="Сохранение...",(t=c.value,r=u.value,fetch("".concat(E.baseUrl,"/cards"),{method:"POST",headers:E.headers,body:JSON.stringify({name:t,link:r})}).then((function(e){return k(e)}))).then((function(t){A.prepend(P(t.likes,t.link,t.name,t._id,t.owner._id)),e.target.reset(),n(s)})).catch((function(e){console.log("Ошибка при добавлении карточки: ".concat(e))})).finally((function(){v.textContent="Создать"})),g(Q,v,C)})),o.addEventListener("submit",(function(e){var t,r;e.preventDefault(),m.textContent="Сохранение...",(t=y.value,r=_.value,fetch("".concat(E.baseUrl,"/users/me"),{method:"PATCH",headers:E.headers,body:JSON.stringify({name:t,about:r})}).then((function(e){return k(e)}))).then((function(){d.textContent=a.value,f.textContent=l.value,n(i)})).catch((function(e){return console.log(e)})).finally((function(){m.textContent="Сохранить"}))})),h.addEventListener("submit",(function(e){var t;e.preventDefault(),S.textContent="Сохранение...",(t=q.value,fetch("".concat(E.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:E.headers,body:JSON.stringify({avatar:t})}).then((function(e){return k(e)}))).then((function(t){X(t),e.target.reset(),n(b)})).catch((function(e){console.log("Ошибка при изменении аватарки: ".concat(e))})).finally((function(){S.textContent="Создать"})),g(R,S,C)})),K.addEventListener("click",(function(){return n(b)})),H.addEventListener("click",(function(){t(s),v.classList.add(C.inactiveButtonClass),v.textContent="Создать"})),z.addEventListener("click",(function(){return n(s)})),M.addEventListener("click",(function(){return n(i)})),$.addEventListener("click",(function(){return n(O)})),G.addEventListener("click",(function(){t(b),S.classList.add(C.inactiveButtonClass),S.textContent="Создать"})),Promise.all([fetch("".concat(E.baseUrl,"/users/me"),{headers:E.headers}).then((function(e){return k(e)})),fetch("".concat(E.baseUrl,"/cards"),{headers:E.headers}).then((function(e){return k(e)}))]).then((function(e){X(e[0]),D=e[0]._id;var t,n=T(e[1]);try{for(n.s();!(t=n.n()).done;){var r=t.value;A.append(P(r.likes,r.link,r.name,r._id,r.owner._id))}}catch(e){n.e(e)}finally{n.f()}})).catch((function(e){console.log(e)})),I=C,Array.from(document.querySelectorAll(I.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),L(e,I),Array.from(e.querySelectorAll(I.fieldsetSelector)).forEach((function(e){L(e,I)}))}))})();